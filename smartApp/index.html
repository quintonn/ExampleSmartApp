<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Example-SMART-App</title>
    <!-- FHIR Client JS Library -->
    <script src="./lib/js/fhir-client-v0.1.12.js?v=4"></script>
  </head>
  <body>
    <h1>Redirecting...</h1>
    <script>
      (function (window) {
        var state = '';
        var queryParams = window.location.search.substring(1).split('&');
        for (var i = 0; i < queryParams.length; i++) {
          var parts = queryParams[i].split('=');
          if (parts[0] == 'state') {
            state = parts[1];
            break;
          }
        }

        var sessionState = sessionStorage[state];
        // redirect back to main app
        setTimeout(function () {
          console.log(window.location.search);
          console.log(sessionState);
          alert('redirecting....');

          window.location.href =
            'https://quintonn.github.io/ExampleSmartApp/webApp/index.html' +
            window.location.search +
            '&sessionstate=' +
            btoa(sessionState) +
            '&close=true';
        }, 3000);
      })(window);
    </script>
  </body>
</html>
